<!DOCTYPE html>
<html>
<head>
    <title>Imouge example</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.flot.min.js"></script>
    <script src="../dist/imouge.js"></script>
</head>
<body>
    <canvas width="505" height="362" id="original"></canvas>
    <canvas width="505" height="362" id="work"></canvas>
    <h1>Histogram</h1>
    <div id="histogram" style="width:1000px; height:600px"></div>
    <h1>Logaritmic Histogram</h1>
    <div id="log_histogram" style="width:1000px; height:600px"></div>


    <script type="text/javascript">
        (function () {
            var canvas, canvas_work, width, height, ctx, ctx_work, img,
                histogram, histogram_plot;

            canvas      = document.getElementById("original");
            canvas_work = document.getElementById("work");
            width       = canvas.width;
            height      = canvas.height;
            ctx         = canvas.getContext("2d");
            ctx_work    = canvas_work.getContext("2d");
            img         = new Image();

            img.src         = "platypus.png";
            img.onload      = function () {
                var imdata, i, l, r, g, b, graylevel;

                ctx.drawImage(img, 0, 0);
                imdata = ctx.getImageData(0, 0, width, height);

                imdata.data = imouge.image.histogram.getImage(imdata.data);
                ctx_work.putImageData(imdata, 0, 0);

                var init = new Date();

                histogram      = imouge.image.histogram.get(ctx.getImageData(0, 0, width, height).data);
                histogram_plot = [];

                console.log("Time histogram: " + (new Date() - init)+"ms");

                for(i=0, l=histogram.length; i<l; i++) {
                    histogram_plot.push([i,histogram[i]]);
                }

                $.plot("#histogram", [histogram_plot], {
                    series: {
                        color     : "#555555",
                        bars      : {show: true}
                    }
                });

                /*var hl = [];
                for(i=0, l=256; i<l; i++) {
                    var val = Math.log(i)*(255/Math.log(255));
                    val--;
                    val = val < 0 ? 0 : val;
                    console.log(val);
                    hl.push([i,val]);
                }*/

                var hl = imouge.image.histogram.modify(histogram, function (v) {
                    return Math.log(i)
                });

                console.log(hl);

                $.plot("#log_histogram", [hl]);
            }; 
        })();
    </script>
</body>
</html>